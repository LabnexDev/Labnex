import{j as e}from"./markdown-core-J3SG-zFE.js";import{r as t,a as r,c as s,u as a,L as n}from"./router-W3ruk9z3.js";import{b as i,u as l,c as o}from"./query-DQpHUI-d.js";import{u as c,d,a as m}from"./projects-C7_LdZWl.js";import{a as x,L as u,B as g,b as h,F as y,c as p}from"../assets/index-DzQGG0sq.js";import{c as f,g as j}from"./react-core-eVk5PToZ.js";import{c as v}from"./other-heavy-BrS_fVLY.js";import{I as b}from"./Input-Di4d9ysK.js";import{F as w}from"./XMarkIcon-Bv5SMunc.js";import{F as N}from"./MagnifyingGlassIcon-BlioOLwv.js";import{F as k}from"./PencilSquareIcon-2N_h3NB9.js";import{F as I}from"./TrashIcon-S028_C7U.js";import{F as C}from"./UsersIcon-DI-h9Yxi.js";import{F as E}from"./PencilIcon-CwciGq70.js";import{F as R}from"./PlusCircleIcon-B2u9WL21.js";import{F as T}from"./DocumentTextIcon-DV1PdmDa.js";import{F as O}from"./CalendarDaysIcon-DBg9AJpN.js";import{F as P}from"./ClockIcon-Cv-9l8Jz.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";function F({title:e,titleId:r,...s},a){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":r},s),e?t.createElement("title",{id:r},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"}))}const S=t.forwardRef(F);function _({title:e,titleId:r,...s},a){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":r},s),e?t.createElement("title",{id:r},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const A=t.forwardRef(_);var L=(e=>(e.PROJECT_OWNER="PROJECT_OWNER",e.TEST_MANAGER="TEST_MANAGER",e.TESTER="TESTER",e.VIEWER="VIEWER",e))(L||{});const $=async e=>{try{return(await x.post("/roles/assign",e)).data}catch(t){throw new Error(t.response?.data?.message||"Failed to assign role")}};var D,M,W,q,z,U,J,K,Q,B,V,G,Z,X,Y,H,ee,te,re,se,ae,ne,ie,le,oe,ce,de,me;function xe(){if(M)return D;return M=1,D=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}}function ue(){if(U)return z;U=1;var e=function(){if(q)return W;q=1;var e="object"==typeof f&&f&&f.Object===Object&&f;return W=e}(),t="object"==typeof self&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return z=r}function ge(){if(G)return V;G=1;var e=function(){if(B)return Q;B=1;var e=/\s/;return Q=function(t){for(var r=t.length;r--&&e.test(t.charAt(r)););return r}}(),t=/^\s+/;return V=function(r){return r?r.slice(0,e(r)+1).replace(t,""):r}}function he(){if(X)return Z;X=1;var e=ue().Symbol;return Z=e}function ye(){if(se)return re;se=1;var e=he(),t=function(){if(H)return Y;H=1;var e=he(),t=Object.prototype,r=t.hasOwnProperty,s=t.toString,a=e?e.toStringTag:void 0;return Y=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(o){}var l=s.call(e);return i&&(t?e[a]=n:delete e[a]),l}}(),r=function(){if(te)return ee;te=1;var e=Object.prototype.toString;return ee=function(t){return e.call(t)}}(),s=e?e.toStringTag:void 0;return re=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?t(e):r(e)}}function pe(){if(le)return ie;le=1;var e=ye(),t=ne?ae:(ne=1,ae=function(e){return null!=e&&"object"==typeof e});return ie=function(r){return"symbol"==typeof r||t(r)&&"[object Symbol]"==e(r)}}const fe=j(function(){if(me)return de;me=1;var e=xe(),t=function(){if(K)return J;K=1;var e=ue();return J=function(){return e.Date.now()}}(),r=function(){if(ce)return oe;ce=1;var e=ge(),t=xe(),r=pe(),s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,n=/^0o[0-7]+$/i,i=parseInt;return oe=function(l){if("number"==typeof l)return l;if(r(l))return NaN;if(t(l)){var o="function"==typeof l.valueOf?l.valueOf():l;l=t(o)?o+"":o}if("string"!=typeof l)return 0===l?l:+l;l=e(l);var c=a.test(l);return c||n.test(l)?i(l.slice(2),c?2:8):s.test(l)?NaN:+l}}(),s=Math.max,a=Math.min;return de=function(n,i,l){var o,c,d,m,x,u,g=0,h=!1,y=!1,p=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function f(e){var t=o,r=c;return o=c=void 0,g=e,m=n.apply(r,t)}function j(e){var t=e-u;return void 0===u||t>=i||t<0||y&&e-g>=d}function v(){var e=t();if(j(e))return b(e);x=setTimeout(v,function(e){var t=i-(e-u);return y?a(t,d-(e-g)):t}(e))}function b(e){return x=void 0,p&&o?f(e):(o=c=void 0,m)}function w(){var e=t(),r=j(e);if(o=arguments,c=this,u=e,r){if(void 0===x)return function(e){return g=e,x=setTimeout(v,i),h?f(e):m}(u);if(y)return clearTimeout(x),x=setTimeout(v,i),f(u)}return void 0===x&&(x=setTimeout(v,i)),m}return i=r(i)||0,e(l)&&(h=!!l.leading,d=(y="maxWait"in l)?s(r(l.maxWait)||0,i):d,p="trailing"in l?!!l.trailing:p),w.cancel=function(){void 0!==x&&clearTimeout(x),g=0,o=u=c=x=void 0},w.flush=function(){return void 0===x?m:b(t())},w}}()),je=({isOpen:t,onClose:s,title:a,children:n,footer:i,size:l="md"})=>{if(!t)return null;const o=void 0!==a||void 0!==s,c=e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:s,children:e.jsxs("div",{className:`relative w-full ${{sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl"}[l]} rounded-xl shadow-2xl bg-[var(--lnx-surface)] dark:bg-gradient-to-br dark:from-gray-800 dark:to-gray-900 border border-[var(--lnx-border)] dark:border-gray-700/50 flex flex-col max-h-[90vh] transition-all duration-300 ease-in-out transform scale-95 opacity-0 animate-modal-appear`,onClick:e=>e.stopPropagation(),children:[o&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700/50",children:[a&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),s&&e.jsx("button",{onClick:s,className:"p-1 rounded-full text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700/50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors","aria-label":"Close modal",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:n}),i&&e.jsx("div",{className:"flex items-center justify-end p-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700/50 rounded-b-xl space-x-3",children:i})]})});return r.createPortal(c,document.body)},ve=({projectId:r,userRole:s})=>{const[a,n]=t.useState(!1),[c,d]=t.useState(""),[m,h]=t.useState(""),[y,p]=t.useState(L.TESTER),[f,j]=t.useState(!1),[w,E]=t.useState(null),[R,T]=t.useState(L.TESTER),O=i(),{data:P,isLoading:F}=l({queryKey:["projectRoles",r],queryFn:()=>(async e=>{try{return(await x.get(`/roles/project/${e}`)).data}catch(t){throw new Error(t.response?.data?.message||"Failed to get project roles")}})(r)}),{data:S,isLoading:_}=l({queryKey:["userSearch",m],queryFn:()=>(async e=>{try{return(await x.get(`/roles/search?query=${encodeURIComponent(e)}`)).data}catch(t){throw new Error(t.response?.data?.message||"Failed to search users")}})(m),enabled:m.length>2}),D=o({mutationFn:$,onSuccess:()=>{O.invalidateQueries({queryKey:["projectRoles",r]}),v.success("Role updated successfully"),a&&(n(!1),h("")),f&&(j(!1),E(null))},onError:e=>{v.error(e.response?.data?.message||"Failed to update role")}}),M=o({mutationFn:$,onSuccess:()=>{O.invalidateQueries({queryKey:["projectRoles",r]}),v.success("User invited successfully"),n(!1),h("")},onError:e=>{v.error(e.response?.data?.message||"Failed to invite user")}}),W=o({mutationFn:({userId:e})=>(async(e,t)=>{try{await x.delete(`/roles/project/${e}/user/${t}`)}catch(r){throw new Error(r.response?.data?.message||"Failed to remove role")}})(r,e),onSuccess:()=>{O.invalidateQueries({queryKey:["projectRoles",r]}),v.success("Member removed successfully")},onError:e=>{v.error(e.response?.data?.message||"Failed to remove member")}}),q=s===L.PROJECT_OWNER,z=e=>{E(e),T(e.type),j(!0)},U=e=>{window.confirm("Are you sure you want to remove this member?")&&W.mutate({userId:e})},J=fe(e=>{h(e)},300);t.useEffect(()=>()=>{J.cancel()},[J]);const K=P?.filter(e=>e.userId.name.toLowerCase().includes(c.toLowerCase())||e.userId.email.toLowerCase().includes(c.toLowerCase())),Q=S?.filter(e=>!P?.some(t=>t.userId._id===e._id));return F?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(u,{size:"md"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Team Members (",K?.length||0,")"]}),q&&e.jsx(g,{variant:"primary",onClick:()=>n(!0),leftIcon:e.jsx(A,{className:"h-5 w-5"}),children:"Invite Member"})]}),e.jsx(b,{type:"text",placeholder:"Search current team members...",value:c,onChange:e=>d(e.target.value),leftIcon:e.jsx(N,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),K&&K.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden 2xl:block -mx-4 2xl:-mx-6 mt-4 flow-root",children:e.jsx("div",{className:"inline-block min-w-full align-middle sm:px-6 lg:px-8 overflow-x-auto",children:e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 dark:ring-gray-700 sm:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-gray-700 table-fixed w-full",children:[e.jsx("thead",{className:"bg-[var(--lnx-surface)] dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"w-3/5 py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-white sm:pl-6",children:"Name"}),e.jsx("th",{scope:"col",className:"w-24 sm:w-[150px] px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white",children:"Role"}),q&&e.jsx("th",{scope:"col",className:"w-20 sm:w-[100px] relative py-3.5 pl-3 pr-4 sm:pr-6",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700/50 bg-white dark:bg-gray-800/50",children:K?.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors duration-150",children:[e.jsx("td",{className:"py-4 pl-4 pr-3 text-sm sm:pl-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-base font-medium text-gray-700 dark:text-gray-300",children:t.userId.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4 overflow-hidden",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.userId.name}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 truncate",children:t.userId.email})]})]})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-300 text-center",children:e.jsx("span",{className:`inline-flex items-center rounded-md ${t.type===L.PROJECT_OWNER?"px-1":"px-2"} py-1 text-xs font-medium ring-1 ring-inset ${t.type===L.PROJECT_OWNER?"bg-yellow-100 dark:bg-yellow-700 text-yellow-800 dark:text-yellow-200 ring-yellow-500/30 dark:ring-yellow-500/30":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-200 ring-gray-500/10 dark:ring-gray-500/30"}`,children:t.type.replace(/_/g," ")})}),q&&e.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-2",children:t.type!==L.PROJECT_OWNER&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:"tertiary",size:"sm",onClick:()=>z(t),className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Edit Role",children:[e.jsx(k,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Edit Role"})]}),e.jsxs(g,{variant:"tertiary",size:"sm",onClick:()=>U(t.userId._id),isLoading:W.isPending&&W.variables?.userId===t.userId._id,className:"text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400 p-1",title:"Remove Member",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Remove Member"})]})]})})]},t._id))})]})})})}),e.jsx("ul",{className:"2xl:hidden mt-4 space-y-4",children:K.map(t=>e.jsxs("li",{className:"card p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-base font-medium text-gray-700 dark:text-gray-300",children:t.userId.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"truncate",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.userId.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t.userId.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset "+(t.type===L.PROJECT_OWNER?"bg-yellow-100 dark:bg-yellow-700 text-yellow-800 dark:text-yellow-200 ring-yellow-500/30 dark:ring-yellow-500/30":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-200 ring-gray-500/10 dark:ring-gray-500/30"),children:t.type.replace(/_/g," ")}),q&&t.type!==L.PROJECT_OWNER&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"tertiary",size:"sm",className:"p-1",onClick:()=>z(t),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(g,{variant:"tertiary",size:"sm",className:"p-1",onClick:()=>U(t.userId._id),children:e.jsx(I,{className:"h-4 w-4"})})]})]})]},t._id))})]}):e.jsxs("div",{className:"text-center py-8 px-4 card border-dashed",children:[e.jsx(C,{className:"mx-auto h-10 w-10 text-gray-400 dark:text-gray-500"}),e.jsx("h4",{className:"mt-2 text-md font-semibold text-gray-900 dark:text-white",children:"No Team Members Yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:q?"Invite members to collaborate on this project.":"This project currently has no assigned team members."}),q&&e.jsx(g,{variant:"primary",onClick:()=>n(!0),leftIcon:e.jsx(A,{className:"h-5 w-5"}),className:"mt-4",children:"Invite First Member"})]}),e.jsxs(je,{isOpen:a,onClose:()=>n(!1),title:"Invite New Team Member",size:"2xl",children:[e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(b,{label:"Search users by name or email",type:"text",placeholder:"Start typing to search... (min 3 chars)",onChange:e=>J(e.target.value),onKeyPress:e=>{"Enter"===e.key&&e.preventDefault()},leftIcon:e.jsx(N,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),_&&e.jsx(u,{size:"sm",className:"my-3"}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 pr-1",children:Q&&Q.length>0?Q?.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors duration-150",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.email})]}),e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>{return e=t,void M.mutate({userId:e._id,projectId:r,roleType:y});var e},isLoading:M.isPending&&M.variables?.userId===t._id,children:["Invite as ",y.replace("_"," ")]})]},t._id)):!_&&m.length>2&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No users found matching your search, or all found users are already in the team."})}),Q&&Q.length>0&&e.jsx(b,{as:"select",label:"Assign Role for New Invites",value:y,onChange:e=>p(e.target.value),hideLabel:!1,className:"max-w-xs",children:Object.values(L).filter(e=>e!==L.PROJECT_OWNER).map(t=>e.jsx("option",{value:t,children:t.replace(/_/g," ")},t))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(g,{variant:"tertiary",onClick:()=>n(!1),children:"Cancel"})})]}),w&&e.jsxs(je,{isOpen:f,onClose:()=>{j(!1),E(null)},title:"Edit Member Role",size:"sm",children:[e.jsx("div",{className:"space-y-4 mt-4",children:e.jsx(b,{as:"select",label:"Role",value:R,onChange:e=>T(e.target.value),className:"max-w-xs",children:Object.values(L).filter(e=>e!==L.PROJECT_OWNER).map(t=>e.jsx("option",{value:t,children:t.replace(/_/g," ")},t))})}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx(g,{variant:"tertiary",onClick:()=>{j(!1),E(null)},children:"Cancel"}),e.jsx(g,{variant:"primary",onClick:()=>{var e,t;w&&(e=w.userId._id,t=R,D.mutate({userId:e,projectId:r,roleType:t}))},isLoading:D.isPending&&D.variables?.userId===w?.userId._id&&D.variables?.roleType===R,children:"Save Changes"})]})]})]})},be=({id:t,checked:r,onChange:s,disabled:a,label:n})=>e.jsxs("div",{className:"flex items-center",children:[n&&e.jsx("label",{htmlFor:t,className:"mr-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:n}),e.jsx("button",{id:t,type:"button",role:"switch","aria-checked":r,onClick:()=>!a&&s(!r),disabled:a,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 ${r?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-600"} ${a?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:e.jsx("span",{className:"inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ease-in-out "+(r?"translate-x-6":"translate-x-1")})})]}),we=()=>{const{id:r}=s(),f=a(),j=i(),{setPageContext:b}=h();t.useEffect(()=>{r&&"undefined"!==r||(v.error("Invalid project ID in URL. Redirecting to dashboard."),f("/dashboard"))},[r,f]);const{data:w,isLoading:N,error:k}=l({queryKey:["project",r],queryFn:()=>r&&"undefined"!==r?m(r):Promise.reject(new Error("Invalid project ID")),enabled:!!r&&"undefined"!==r,retry:1}),{data:F,isLoading:_}=l({queryKey:["userRole",r],queryFn:()=>r&&"undefined"!==r?(async e=>{try{return(await x.get(`/roles/project/${e}/user`)).data}catch(t){throw new Error(t.response?.data?.message||"Failed to get user role")}})(r):Promise.reject(new Error("Invalid project ID for userRole")),enabled:!!r&&"undefined"!==r&&!!w}),A=o({mutationFn:e=>{if(!r||"undefined"===r)return Promise.reject(new Error("Invalid project ID for update"));const t={name:w?.name,description:w?.description,...e};return c(r,t)},onSuccess:e=>{v.success(`Project "${e.name}" status updated successfully.`),j.invalidateQueries({queryKey:["project",r]}),j.invalidateQueries({queryKey:["projects"]})},onError:e=>{v.error(e.response?.data?.message||"Failed to update project status.")}}),$=o({mutationFn:()=>r&&"undefined"!==r?d(r):Promise.reject(new Error("Invalid project ID for deletion")),onSuccess:()=>{v.success(`Project "${w?.name||"Unknown"}" deleted successfully.`),j.invalidateQueries({queryKey:["projects"]}),f("/")},onError:e=>{v.error(e.response?.data?.message||"Failed to delete project.")}}),D=F?.type===L.PROJECT_OWNER;return t.useEffect(()=>{w&&b({view:"projectDetails",projectId:w._id,projectName:w.name,description:w.description,isActive:w.isActive})},[w,b]),N||r&&w&&_?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(u,{size:"lg"})}):k||!w?e.jsxs("div",{className:"card text-center p-12",children:[e.jsx(y,{className:"h-16 w-16 text-red-500 dark:text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:"Project Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"We couldn't find the project you were looking for. It might have been deleted or the ID is incorrect."}),e.jsx(g,{variant:"primary",onClick:()=>f("/projects"),children:"Back to Projects"})]}):e.jsxs("div",{className:"space-y-8 py-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:w.name}),w.description&&e.jsx("p",{className:"mt-1 text-md text-gray-600 dark:text-gray-400 max-w-2xl",children:w.description})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap sm:flex-nowrap w-full sm:w-auto",children:[D&&e.jsx(g,{variant:"secondary",onClick:()=>{r&&"undefined"!==r?f(`/projects/${r}/edit`):v.error("Cannot edit: Invalid project context.")},leftIcon:e.jsx(E,{className:"h-5 w-5"}),className:"w-full sm:w-auto",children:"Edit Project"}),e.jsx(g,{variant:"primary",onClick:()=>{r&&"undefined"!==r?f(`/projects/${r}/test-cases/new`):v.error("Cannot add test case: Invalid project context.")},leftIcon:e.jsx(R,{className:"h-5 w-5"}),className:"w-full sm:w-auto",children:"Add Test Case"}),e.jsx(g,{variant:"secondary",onClick:()=>{r&&"undefined"!==r?f(`/projects/${r}/tasks`):v.error("Cannot view tasks: Invalid project context.")},leftIcon:e.jsx(p,{className:"h-5 w-5"}),className:"w-full sm:w-auto",children:"View Tasks"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(T,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Project Overview"]}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1.5"})," Created Date"]}),e.jsx("dd",{className:"mt-1 text-gray-900 dark:text-white",children:new Date(w.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1.5"})," Last Updated"]}),e.jsx("dd",{className:"mt-1 text-gray-900 dark:text-white",children:new Date(w.updatedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-1.5"})," Project ID"]}),e.jsx("dd",{className:"mt-1 text-gray-900 dark:text-white font-mono text-xs bg-gray-100 dark:bg-gray-700 p-1 rounded inline-block",children:w._id})]}),w.projectCode&&e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-1.5"})," Project Code"]}),e.jsx("dd",{className:"mt-1 text-gray-900 dark:text-white font-mono text-sm bg-blue-100 dark:bg-blue-700/50 text-blue-700 dark:text-blue-300 px-2 py-1 rounded inline-block",children:w.projectCode})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-1.5"})," Project Owner"]}),e.jsxs("dd",{className:"mt-1 text-gray-900 dark:text-white",children:[w.owner.name," (",w.owner.email,")"]})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(S,{className:"h-4 w-4 mr-1.5"})," Active Status"]}),e.jsxs("dd",{className:"mt-1 flex items-center",children:[D?e.jsx(be,{id:`project-status-toggle-${w._id}`,checked:w.isActive,onChange:e=>{w&&A.mutate({isActive:e})},disabled:A.isPending}):e.jsx("span",{className:"px-2 py-0.5 inline-block text-xs font-semibold rounded-full "+(w.isActive?"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100":"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-100"),children:w.isActive?"Active":"Inactive"}),e.jsxs("span",{className:"ml-2 text-xs font-semibold "+(w.isActive?"text-green-700 dark:text-green-300":"text-gray-600 dark:text-gray-400"),children:["(",w.isActive?"Active":"Inactive",")"]})]})]})]})]}),e.jsxs("section",{className:"card p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Test Cases (",w.testCaseCount||0,")"]}),e.jsx(g,{variant:"secondary",size:"sm",onClick:()=>{r&&"undefined"!==r?f(`/projects/${r}/test-cases`):v.error("Cannot view test cases: Invalid project context.")},children:"View All Test Cases"})]}),w.recentTestCases&&w.recentTestCases.length>0?e.jsx("ul",{className:"space-y-3 mt-4",children:w.recentTestCases.map(t=>e.jsxs("li",{className:"card p-3 hover:shadow-glow-blue transition-shadow duration-200 cursor-pointer",onClick:()=>f(`/projects/${r}/test-cases/${t._id}`),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[t.taskReferenceId&&e.jsx("span",{className:"mr-2 text-xs font-mono bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-300 px-1.5 py-0.5 rounded",children:t.taskReferenceId}),e.jsx(n,{to:`/projects/${r}/test-cases/${t._id}`,className:"font-medium text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 truncate align-middle",title:t.name,children:t.name})]}),e.jsx("span",{className:"px-2 py-0.5 inline-block text-xs font-semibold rounded-full "+("pass"===t.status?"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100":"fail"===t.status?"bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100":"bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100"),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Last updated: ",new Date(t.updatedAt).toLocaleDateString()]})]},t._id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No test cases yet. Start by adding one!"})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(C,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Team Management"]}),e.jsx(ve,{projectId:w._id,userRole:F?.type||L.VIEWER})]}),D&&e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(I,{className:"h-6 w-6 mr-2 text-red-500 dark:text-red-400"})," Delete Project"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Permanently delete this project and all its associated data, including test cases. This action cannot be undone."}),e.jsx(g,{variant:"danger",onClick:()=>{window.confirm(`Are you sure you want to delete the project "${w?.name}"? This action cannot be undone.`)&&$.mutate()},isLoading:$.isPending,className:"w-full",children:"Delete This Project"})]})]})]})]})};export{we as ProjectDetails};
