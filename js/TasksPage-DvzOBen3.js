import{j as e}from"./markdown-core-J3SG-zFE.js";import{c as s,r as t}from"./router-W3ruk9z3.js";import{b as a,u as r,c as l}from"./query-DQpHUI-d.js";import{T as i,a as o,d as n,c as d,u as c,g as m}from"./tasks-DdZhjJsD.js";import{a as x}from"./projects-C7_LdZWl.js";import{b as u}from"./testCases-t9GenQsh.js";import{B as p}from"../assets/index-DzQGG0sq.js";import{M as h}from"./Modal-B3wKZjd4.js";import{c as g}from"./other-heavy-BrS_fVLY.js";import{F as b}from"./PlusIcon-DmexcfTS.js";import{F as j}from"./PencilIcon-CwciGq70.js";import{F as f}from"./TrashIcon-S028_C7U.js";import{F as v}from"./ExclamationTriangleIcon-CjBC6hcD.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";import"./ui-headless-BOwnFwqN.js";import"./XMarkIcon-Bv5SMunc.js";const N={title:"",description:"",priority:o.MEDIUM,status:i.TODO,assignedTo:void 0,testCases:[],dueDate:""},y=()=>{const{projectId:y}=s(),k=a(),[w,C]=t.useState(!1),[T,D]=t.useState("create"),[E,I]=t.useState(null),[F,P]=t.useState(!1),[S,L]=t.useState(null),[_,q]=t.useState(N),{data:M,isLoading:O,isError:z,error:R}=r({queryKey:["tasks",y],queryFn:()=>m(y),enabled:!!y}),{data:$,isLoading:K,isError:B,error:A}=r({queryKey:["project",y],queryFn:()=>x(y),enabled:!!y}),{data:H,isLoading:V,isError:Q,error:G}=r({queryKey:["projectTestCases",y],queryFn:()=>u(y),enabled:!!y}),U=l({mutationFn:e=>d(y,e),onSuccess:e=>{const s=e.taskReferenceId?`Task "${e.title}" (${e.taskReferenceId}) created successfully!`:`Task "${e.title}" created successfully!`;g.success(s),k.invalidateQueries({queryKey:["tasks",y]}),C(!1)},onError:e=>{g.error(`Failed to create task: ${e.message}`)}}),W=l({mutationFn:({taskId:e,data:s})=>c(y,e,s),onSuccess:e=>{g.success(`Task "${e.title}" updated successfully!`),k.invalidateQueries({queryKey:["tasks",y]}),k.invalidateQueries({queryKey:["task",y,e._id]}),C(!1)},onError:e=>{g.error(`Failed to update task: ${e.message}`)}}),{mutate:X,isPending:J}=l({mutationFn:({projId:e,taskId:s})=>n(e,s),onSuccess:()=>{g.success("Task deleted successfully!"),k.invalidateQueries({queryKey:["tasks",y]}),P(!1),L(null)},onError:e=>{g.error(e.response?.data?.message||"Failed to delete task."),P(!1),L(null)}}),Y=e=>{const{name:s,value:t,type:a}=e.target;if("select-multiple"===a){const t=e.target.selectedOptions,a=Array.from(t).map(e=>e.value);q(e=>({...e,[s]:a}))}else q(e=>({...e,[s]:""!==t||"assignedTo"!==s&&"dueDate"!==s?t:void 0}))},Z=()=>{D("create"),I(null),q(N),C(!0)},ee=e=>{D("edit"),I(e),q({title:e.title,description:e.description||"",assignedTo:e.assignedTo?.id,priority:e.priority,status:e.status,testCases:e.testCases?.map(e=>e._id)||[],dueDate:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:""}),C(!0)};if(O||K||V)return e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-[60vh]",children:[e.jsxs("svg",{className:"animate-spin h-12 w-12 text-blue-400 mb-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("p",{className:"text-slate-200 text-xl font-semibold",children:"Loading Project Tasks..."}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Hang tight, we're getting everything ready!"})]});const se=(s,t,a)=>e.jsxs("div",{className:"card p-10 max-w-lg mx-auto text-center",children:[e.jsx(v,{className:"h-16 w-16 text-red-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-red-300 mb-2",children:s}),e.jsx("p",{className:"text-slate-300 text-center",children:t}),a&&e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Details: ",a]})]});return z?se("Error Loading Tasks","Could not fetch tasks for this project. Please try again later.",R?.message):B?se("Error Loading Project Details","Could not fetch project information. Please try again.",A?.message):Q?se("Error Loading Test Cases","There was an issue fetching test case details for this project. Please try refreshing the page.",G?.message):e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-300",children:$?.name?`Tasks: ${$.name}`:"Project Tasks"}),e.jsxs(p,{onClick:Z,variant:"primary",className:"shadow-md hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:[e.jsx(b,{className:"h-5 w-5 mr-1.5"})," Create New Task"]})]}),M&&M.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 md:gap-6",children:M.map(s=>{return e.jsxs("div",{className:"card hover:shadow-glow-brand transition-shadow duration-300 cursor-pointer hover:-translate-y-1 flex flex-col justify-between group",onClick:()=>!w&&!F&&ee(s),children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"w-full overflow-hidden",children:[s.taskReferenceId&&e.jsx("span",{className:"block text-xs font-mono text-slate-400 mb-0.5 bg-slate-700/50 px-1.5 py-0.5 rounded-sm inline-block",children:s.taskReferenceId}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-blue-300 group-hover:text-blue-200 transition-colors duration-150 truncate pr-2",title:s.title,children:s.title})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-1.5",children:[e.jsx("span",{className:"px-2.5 py-1 rounded-full text-[0.68rem] leading-tight font-medium text-white shadow-sm transition-colors duration-150 "+(a=s.status,a===i.DONE?"bg-green-500 hover:bg-green-400":a===i.IN_PROGRESS?"bg-yellow-500 hover:bg-yellow-400":a===i.BLOCKED?"bg-red-600 hover:bg-red-500":a===i.IN_REVIEW?"bg-purple-500 hover:bg-purple-400":a===i.CANCELLED?"bg-slate-500 hover:bg-slate-400":"bg-sky-600 hover:bg-sky-500"),children:s.status.replace("_"," ")}),e.jsx("span",{className:"px-2.5 py-1 rounded-full text-[0.68rem] leading-tight font-medium text-white shadow-sm transition-colors duration-150 "+(t=s.priority,t===o.HIGH?"bg-red-500 hover:bg-red-400":t===o.MEDIUM?"bg-orange-400 hover:bg-orange-300":"bg-sky-500 hover:bg-sky-400"),children:s.priority})]})]}),e.jsx("p",{className:"text-slate-300/80 mb-4 text-sm min-h-[40px] overflow-hidden line-clamp-2 leading-relaxed group-hover:text-slate-200 transition-colors duration-150",children:s.description||"No description provided."}),e.jsxs("div",{className:"space-y-1.5 text-xs text-slate-400/90 mb-4 border-t border-slate-700/80 pt-3 mt-3",children:[s.assignedTo&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-500",children:"Assigned:"})," ",s.assignedTo.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-500",children:"Reporter:"})," ",s.createdBy.name]}),s.dueDate&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-500",children:"Due:"})," ",new Date(s.dueDate).toLocaleDateString()]})]}),s.testCases&&s.testCases.length>0&&e.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700/80",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1.5 font-semibold",children:"Related Test Cases:"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[s.testCases.slice(0,2).map(s=>e.jsx("span",{className:"px-2 py-1 text-[0.7rem] bg-slate-700 hover:bg-slate-600/70 text-blue-300 transition-colors duration-150 rounded-md truncate cursor-default shadow-sm",title:s.title,children:s.title},s._id)),s.testCases.length>2&&e.jsxs("span",{className:"px-2 py-1 text-[0.7rem] bg-slate-600 text-blue-200 rounded-md cursor-default shadow-sm",children:["+ ",s.testCases.length-2," more"]})]})]})]}),e.jsxs("div",{className:"mt-5 pt-4 border-t border-slate-700/80 flex justify-end space-x-2 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-300",children:[e.jsxs(p,{onClick:e=>{e.stopPropagation(),ee(s)},variant:"secondary",size:"sm",className:"focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-800","aria-label":`Edit task ${s.title}`,children:[e.jsx(j,{className:"h-4 w-4"})," ",e.jsx("span",{className:"ml-1.5 hidden sm:inline",children:"Edit"})]}),e.jsxs(p,{onClick:e=>{e.stopPropagation(),(e=>{L(e),P(!0)})(s)},variant:"danger",size:"sm",className:"focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-800",disabled:J,"aria-label":`Delete task ${s.title}`,children:[e.jsx(f,{className:"h-4 w-4"})," ",e.jsx("span",{className:"ml-1.5 hidden sm:inline",children:"Delete"})]})]})]},s._id);var t,a})}):e.jsxs("div",{className:"card text-center py-12 mt-8",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-slate-500 mx-auto mb-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M9 17h6m-7-10V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2H7a2 2 0 01-2-2v-2m0-4h14M5 11V9a2 2 0 012-2h2"})}),e.jsx("p",{className:"text-slate-200 text-xl font-semibold",children:"No tasks found for this project."}),e.jsx("p",{className:"text-slate-400/80 mt-1.5 mb-6 text-sm max-w-md mx-auto",children:"Be the first to add a task and get things moving! Click the button below to create one."}),e.jsxs(p,{onClick:Z,variant:"primary",size:"lg",className:"shadow-md hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:[e.jsx(b,{className:"h-5 w-5 mr-2"})," Create First Task"]})]}),w&&e.jsx(h,{title:"create"===T?"Create New Task":"Edit Task",isOpen:w,onClose:()=>C(!1),size:"xl",children:e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!_.title||!_.title.trim())return void g.error("Title is required.");const s={..._,assignedTo:_.assignedTo||void 0,dueDate:_.dueDate||void 0,testCases:_.testCases||[]};"create"===T?U.mutate(s):E?._id&&W.mutate({taskId:E._id,data:s})},className:"space-y-6 p-1",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-slate-300 mb-1",children:["Title ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",name:"title",id:"title",value:_.title,onChange:Y,required:!0,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 placeholder-slate-400 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",id:"description",rows:4,value:_.description||"",onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 placeholder-slate-400 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm min-h-[100px]",placeholder:"Provide a detailed description of the task"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-slate-300 mb-1",children:"Status"}),e.jsx("select",{name:"status",id:"status",value:_.status,onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm appearance-none",children:Object.values(i).map(s=>e.jsx("option",{value:s,className:"bg-slate-800 text-slate-100",children:s.replace("_"," ")},s))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-slate-300 mb-1",children:"Priority"}),e.jsx("select",{name:"priority",id:"priority",value:_.priority,onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm appearance-none",children:Object.values(o).map(s=>e.jsx("option",{value:s,className:"bg-slate-800 text-slate-100",children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"assignedTo",className:"block text-sm font-medium text-slate-300 mb-1",children:"Assign To"}),e.jsxs("select",{name:"assignedTo",id:"assignedTo",value:_.assignedTo||"",onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm appearance-none",children:[e.jsx("option",{value:"",className:"bg-slate-800 text-slate-400",children:"Unassigned"}),$?.members.map(s=>e.jsx("option",{value:s._id,className:"bg-slate-800 text-slate-100",children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-slate-300 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",id:"dueDate",value:_.dueDate||"",onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm appearance-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"testCases",className:"block text-sm font-medium text-slate-300 mb-1",children:"Link Test Cases"}),e.jsx("select",{multiple:!0,name:"testCases",id:"testCases",value:_.testCases||[],onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-slate-100 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm min-h-[120px]",children:H&&H.length>0?H.map(s=>e.jsx("option",{value:s._id,className:"p-1.5 hover:bg-blue-500/20 bg-slate-800 text-slate-100",children:s.title},s._id)):e.jsx("option",{value:"",disabled:!0,className:"italic text-slate-500",children:"No test cases available in this project"})}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Hold Ctrl (or Cmd on Mac) to select multiple test cases."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:()=>C(!1),className:"px-5",children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",isLoading:U.isPending||W.isPending,className:"px-5",children:"create"===T?"Create Task":"Save Changes"})]})]})}),F&&S&&e.jsx(h,{title:"Confirm Deletion",isOpen:F,onClose:()=>P(!1),size:"md",children:e.jsxs("div",{className:"p-1",children:[e.jsx("p",{className:"text-slate-300 mb-1",children:"Are you sure you want to delete the task:"}),e.jsx("p",{className:"text-xl font-semibold text-blue-300 mb-6 truncate",children:S.title}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(p,{variant:"secondary",onClick:()=>P(!1),className:"px-5",children:"Cancel"}),e.jsx(p,{variant:"danger",onClick:()=>{S&&y&&X({projId:y,taskId:S._id})},isLoading:J,className:"px-5",children:"Delete Task"})]})]})})]})};export{y as default};
