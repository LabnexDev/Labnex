import{j as e}from"./markdown-core-J3SG-zFE.js";import{b as s,u as r,r as t}from"./router-W3ruk9z3.js";import{c as n}from"./query-DQpHUI-d.js";import{l as i}from"./discordIntegration-CGrSMky1.js";import{B as a}from"../assets/index-DzQGG0sq.js";import{C as o}from"./Card-DNmxhqo8.js";import{V as c}from"./other-heavy-BrS_fVLY.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";const l=()=>{const l=s(),m=r(),[d,x]=t.useState(null),[u,h]=t.useState(null),[j,g]=t.useState(null);t.useEffect(()=>{const e=l.hash.substring(1),s=new URLSearchParams(e),r=s.get("token"),t=s.get("discord_id"),n=s.get("discord_username");r?x(r):(c.error("Link token is missing. Please try the link from Discord again."),m("/")),t&&h(t),n&&g(decodeURIComponent(n))},[l.hash,m]);const p=n({mutationFn:i,onSuccess:e=>{c.success(e.message||"Discord account linked successfully!"),m("/settings/integrations")},onError:e=>{c.error(e.message||"Failed to link account. Please try again.")}});return d||p.isPending?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-purple-900 p-4 text-white",children:e.jsxs(o,{className:"w-full max-w-md glassmorphism",children:[e.jsx(o.Title,{children:"Link Discord Account"}),e.jsxs(o.Content,{children:[e.jsxs("p",{className:"mb-6 text-center text-lg",children:["You are about to link your Labnex account with Discord.",u&&e.jsxs("span",{className:"block mt-2 text-sm text-gray-300",children:["Discord User ID: ",u]}),j&&e.jsxs("span",{className:"block mt-1 text-sm text-gray-300",children:["Discord Username: ",e.jsx("span",{className:"font-semibold",children:j})]})]}),e.jsx("p",{className:"mb-6 text-center",children:"Please confirm that you want to proceed."}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(a,{onClick:()=>{d?p.mutate({token:d}):c.error("Cannot link account: Token is missing.")},disabled:p.isPending||!d,variant:"primary",className:"w-full glowing-button-effect",children:p.isPending?"Linking...":"Confirm & Link Account"}),e.jsx(a,{onClick:()=>{m("/")},variant:"secondary",className:"w-full",disabled:p.isPending,children:"Cancel"})]}),p.isError&&e.jsx("p",{className:"mt-4 text-center text-red-400",children:p.error?.message||"An unexpected error occurred."})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 text-white",children:e.jsxs(o,{className:"w-full max-w-md",children:[e.jsx(o.Title,{children:"Invalid Link"}),e.jsxs(o.Content,{children:[e.jsx("p",{children:"The account linking token is missing or invalid. Please try the link from Discord again or generate a new one."}),e.jsx(a,{onClick:()=>m("/"),variant:"primary",className:"mt-4",children:"Go to Homepage"})]})]})})};export{l as default};
