import{j as e}from"./markdown-core-J3SG-zFE.js";import{r as t,L as a}from"./router-W3ruk9z3.js";import{b as s,u as r,c as i}from"./query-DQpHUI-d.js";import{N as n,L as o,B as c,F as l,m as d,g as m,h as u,r as x,i as j,j as f,k as y}from"../assets/index-DzQGG0sq.js";import{c as h}from"./other-heavy-BrS_fVLY.js";import{F as p}from"./CheckIcon-BQVobhmf.js";import{F as v}from"./XMarkIcon-Bv5SMunc.js";import{F as g}from"./EyeIcon-B7Oi3wZ2.js";import{F as N}from"./TrashIcon-S028_C7U.js";import{F as k}from"./ClipboardDocumentListIcon-BnEqRuOb.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";function w({title:e,titleId:a,...s},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},s),e?t.createElement("title",{id:a},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859M12 3v8.25m0 0-3-3m3 3 3-3"}))}const I=t.forwardRef(w),E=t=>{switch(t){case m.PROJECT_INVITE:return e.jsx(I,{className:"h-6 w-6 text-blue-400"});case m.TASK_ASSIGNED:return e.jsx(k,{className:"h-6 w-6 text-green-400"});default:return e.jsx(l,{className:"h-6 w-6 text-slate-400"})}},C=({notification:t,onMarkAsRead:s,onAcceptInvite:r,onRejectInvite:i,onDelete:o})=>e.jsx("div",{className:"card p-4 sm:p-5 shadow-lg transition-all duration-300 hover:shadow-xl "+(t.status===n.PENDING||t.status!==n.READ?"bg-white dark:bg-gray-800":"bg-gray-100 dark:bg-gray-700/50 opacity-70"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:E(t.type)}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:t.message}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[new Date(t.createdAt).toLocaleString(),t.senderId&&` - From: ${t.senderId.name}`]}),t.projectId&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Project: ",e.jsx(a,{to:t.type===m.TASK_ASSIGNED?`/projects/${t.projectId._id}/tasks`:`/projects/${t.projectId._id}`,className:"text-blue-500 hover:underline dark:text-blue-400",children:t.projectId.name})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row items-center gap-2 ml-2",children:[t.status===n.PENDING&&t.type===m.PROJECT_INVITE&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"primary",onClick:()=>r(t._id),leftIcon:e.jsx(p,{className:"h-4 w-4"}),children:"Accept"}),e.jsx(c,{size:"sm",variant:"danger",onClick:()=>i(t._id),leftIcon:e.jsx(v,{className:"h-4 w-4"}),children:"Reject"})]}),t.status!==n.READ&&t.type!==m.PROJECT_INVITE&&e.jsx(c,{size:"sm",variant:"secondary",onClick:()=>s(t._id),title:"Mark as Read",leftIcon:e.jsx(g,{className:"h-4 w-4"}),children:"Mark Read"}),e.jsx(c,{size:"sm",variant:"tertiary",onClick:()=>{window.confirm("Are you sure you want to delete this notification?")&&o(t._id)},title:"Delete Notification",leftIcon:e.jsx(N,{className:"h-4 w-4 text-red-500 dark:text-red-400"}),children:e.jsx(e.Fragment,{})})]})]})});function F(){const a=s(),[m]=t.useState("all"),{data:v,isLoading:g,error:N}=r({queryKey:["notifications"],queryFn:y}),k=i({mutationFn:f,onSuccess:()=>{h.success("Notification marked as read."),a.invalidateQueries({queryKey:["notifications"]}),a.invalidateQueries({queryKey:["userContext"]}),a.invalidateQueries({queryKey:["notifications","unreadCount"]})},onError:()=>h.error("Failed to mark notification as read.")}),w=i({mutationFn:d,onSuccess:()=>{h.success("All notifications marked as read."),a.invalidateQueries({queryKey:["notifications"]}),a.invalidateQueries({queryKey:["userContext"]}),a.invalidateQueries({queryKey:["notifications","unreadCount"]})},onError:()=>h.error("Failed to mark all notifications as read.")}),I=i({mutationFn:j,onSuccess:()=>{h.success("Project invite accepted!"),a.invalidateQueries({queryKey:["notifications"]}),a.invalidateQueries({queryKey:["projects"]}),a.invalidateQueries({queryKey:["userContext"]}),a.invalidateQueries({queryKey:["notifications","unreadCount"]})},onError:e=>h.error(e.response?.data?.message||"Failed to accept invite.")}),E=i({mutationFn:x,onSuccess:()=>{h.success("Project invite rejected."),a.invalidateQueries({queryKey:["notifications"]}),a.invalidateQueries({queryKey:["userContext"]}),a.invalidateQueries({queryKey:["notifications","unreadCount"]})},onError:e=>h.error(e.response?.data?.message||"Failed to reject invite.")}),F=i({mutationFn:u,onSuccess:()=>{h.success("Notification deleted."),a.invalidateQueries({queryKey:["notifications"]}),a.invalidateQueries({queryKey:["userContext"]}),a.invalidateQueries({queryKey:["notifications","unreadCount"]})},onError:e=>h.error(e.response?.data?.message||"Failed to delete notification.")}),A=v?.filter(e=>"unread"!==m||(e.status===n.PENDING||e.status!==n.READ)).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),K=v?.filter(e=>e.status===n.PENDING||e.status!==n.READ).length||0;return g?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(o,{size:"lg"})}):N?e.jsxs("div",{className:"text-center card p-8 text-red-500",children:["Error fetching notifications: ",N.message]}):e.jsxs("div",{className:"container mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Notifications"}),v&&v.length>0&&K>0&&e.jsxs(c,{variant:"primary",onClick:()=>w.mutate(),isLoading:w.isPending,leftIcon:e.jsx(p,{className:"h-5 w-5"}),children:["Mark All as Read (",K,")"]})]}),A&&A.length>0?e.jsx("div",{className:"space-y-4",children:A.map(t=>e.jsx(C,{notification:t,onMarkAsRead:k.mutate,onAcceptInvite:I.mutate,onRejectInvite:E.mutate,onDelete:F.mutate},t._id))}):e.jsxs("div",{className:"card text-center p-12",children:[e.jsx(l,{className:"h-16 w-16 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"No Notifications"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"unread"===m?"You have no unread notifications.":"You currently have no notifications."})]})]})}export{F as NotificationsPage};
