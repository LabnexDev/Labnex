import{j as e}from"./markdown-core-J3SG-zFE.js";import{r as s,u as a,L as t,R as r}from"./router-W3ruk9z3.js";import{b as n,u as i,c as l}from"./query-DQpHUI-d.js";import{a as o,B as d,L as c,u as m,f as x}from"../assets/index-DzQGG0sq.js";import{c as u}from"./other-heavy-BrS_fVLY.js";import{I as h}from"./Input-Di4d9ysK.js";import{C as g}from"./Card-DNmxhqo8.js";import{M as y}from"./Modal-B3wKZjd4.js";import{F as f}from"./CogIcon-w8xhrPdA.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";import"./ui-headless-BOwnFwqN.js";import"./XMarkIcon-Bv5SMunc.js";function p({title:e,titleId:a,...t},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},t),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"}))}const w=s.forwardRef(p);function j({title:e,titleId:a,...t},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},t),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"}))}const b=s.forwardRef(j),k=async e=>(await o.put("/users/profile",e)).data,N=async e=>(await o.put("/users/password",e)).data,v=async e=>(await o.put("/users/notifications",e)).data,P=async()=>(await o.get("/api-keys")).data,C=async e=>(await o.post("/api-keys",{label:e})).data,L=async e=>(await o.delete(`/api-keys/${e}`)).data;function A(){const a=n(),[t,r]=s.useState(""),[o,m]=s.useState(null),[x,f]=s.useState(!1),[p,w]=s.useState(!1),{data:j=[],isLoading:b,isError:k}=i({queryKey:["apiKeys"],queryFn:P}),N=l({mutationFn:C,onSuccess:e=>{u.success("API Key created successfully!"),m(e.token),a.invalidateQueries({queryKey:["apiKeys"]}),f(!1),w(!0)},onError:e=>{u.error(e.response?.data?.message||"Failed to create API key.")}}),v=l({mutationFn:L,onSuccess:()=>{u.success("API Key revoked."),a.invalidateQueries({queryKey:["apiKeys"]})},onError:e=>{u.error(e.response?.data?.message||"Failed to revoke API key.")}}),A=()=>{w(!1),m(null),r("")};return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"API Keys"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Manage API keys for programmatic access to the Labnex API."}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(d,{onClick:()=>f(!0),children:"Generate new key"})}),e.jsxs("div",{className:"space-y-2",children:[b&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(c,{})}),k&&e.jsx("p",{className:"text-center text-red-500",children:"Failed to load API keys."}),!b&&!k&&(0===j.length?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:"No API keys have been generated yet."}):j.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:s.label}),e.jsxs("p",{className:"font-mono text-sm text-gray-500 dark:text-gray-400 break-all",children:[s.prefix,"••••••••"]})]}),e.jsx(d,{variant:"danger",size:"sm",onClick:()=>{return e=s._id,void(window.confirm("Are you sure you want to revoke this key? This action cannot be undone.")&&v.mutate(e));var e},isLoading:v.isPending&&v.variables===s._id,disabled:v.isPending,children:"Revoke"})]},s._id)))]})]})}),e.jsxs(y,{isOpen:x,onClose:()=>f(!1),title:"Generate new API key",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Give your key a descriptive label to remember its purpose."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"key-label",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Label"}),e.jsx(h,{id:"key-label",type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"e.g., 'My Dev Laptop'",disabled:N.isPending})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(d,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(d,{onClick:()=>{t.trim()?N.mutate(t):u.error("Label cannot be empty.")},isLoading:N.isPending,disabled:N.isPending,children:"Generate Key"})]})]}),e.jsxs(y,{isOpen:p,onClose:A,title:"API Key Generated",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/50 p-3 rounded-lg",children:"Please copy this key and store it securely. You will not be able to see it again."}),e.jsx("p",{className:"p-3 bg-gray-100 dark:bg-gray-800 font-mono text-sm break-all rounded-md",children:o}),e.jsx(d,{onClick:()=>navigator.clipboard.writeText(o||""),className:"w-full",children:"Copy to Clipboard"})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(d,{variant:"secondary",onClick:A,children:"Close"})})]})]})}const E=({id:s,checked:a,onChange:t,label:n,srLabel:i,disabled:l})=>{const o=s||`toggle-${r.useId()}`;return e.jsxs("div",{className:"flex items-center",children:[n&&e.jsx("label",{htmlFor:o,className:"mr-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:n}),e.jsxs("button",{id:o,type:"button",role:"switch","aria-checked":a,onClick:()=>!l&&t(!a),className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out \n                    ${a?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-600"}\n                    ${l?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n                    focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800`,disabled:l,children:[e.jsx("span",{className:"sr-only",children:i||n||"Toggle"}),e.jsx("span",{"aria-hidden":"true",className:"inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ease-in-out \n                      "+(a?"translate-x-6":"translate-x-1")})]})]})},I=()=>{const{user:r,logout:i,isLoading:g}=m(),y=n(),{theme:p,toggleTheme:j}=x(),P=a(),[C,L]=s.useState(!1),[I,M]=s.useState({name:"",email:"",currentPassword:"",newPassword:"",confirmPassword:""}),[S,K]=s.useState(""),[q,D]=s.useState(!1),[T,O]=s.useState(""),[z,G]=s.useState("");s.useEffect(()=>{r&&M(e=>({...e,name:r.name||"",email:r.email||""}))},[r]);const Q=e=>{const{name:s,value:a}=e.target;M(e=>({...e,[s]:a})),"newPassword"!==s&&"confirmPassword"!==s&&"currentPassword"!==s||K("")},R=l({mutationFn:k,onSuccess:()=>{u.success("Profile updated successfully!"),y.invalidateQueries({queryKey:["user"]}),y.invalidateQueries({queryKey:["profile"]})},onError:e=>{u.error(e.response?.data?.message||"Failed to update profile.")}}),B=l({mutationFn:N,onSuccess:e=>{u.success(e.message||"Password updated successfully!"),M(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),K("")},onError:e=>{K(e.response?.data?.message||"Failed to update password.")}}),$=l({mutationFn:v,onSuccess:()=>{y.invalidateQueries({queryKey:["user"]}),u.success("Notification preferences updated.")},onError:e=>{u.error(e.response?.data?.message||"Failed to update notification preferences.")}}),W=l({mutationFn:e=>(async e=>(await o.delete("/users/me",{data:{currentPassword:e}})).data)(e),onSuccess:e=>{u.success(e.message||"Account deleted successfully."),i(),P("/login",{replace:!0})},onError:e=>{G(e.response?.data?.message||"Failed to delete account. Please check your password.")}}),_=()=>{D(!1),O(""),G("")};return g?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(c,{size:"lg"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Settings"}),e.jsxs("section",{className:"card p-6 sm:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"Appearance"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Customize the look and feel of Labnex."}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 dark:text-white",children:"Theme"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Current: ","dark"===p?"Dark Mode":"Light Mode"]})]}),e.jsxs(d,{variant:"secondary",onClick:j,leftIcon:"dark"===p?e.jsx(b,{className:"h-5 w-5"}):e.jsx(w,{className:"h-5 w-5"}),children:["Switch to ","dark"===p?"Light":"Dark"," Mode"]})]})]}),e.jsxs("section",{className:"card p-6 sm:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"Profile Information"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage your personal details and password."})]}),e.jsx(d,{variant:C?"tertiary":"secondary",onClick:()=>{L(!C),C&&(M(e=>({...e,name:r?.name||"",email:r?.email||"",currentPassword:"",newPassword:"",confirmPassword:""})),K(""))},className:"w-full sm:w-auto",children:C?"Cancel Editing":"Edit Profile"})]}),C?e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),K("");const s={};I.name!==r?.name&&(s.name=I.name),I.email!==r?.email&&(s.email=I.email);let a=!0;if(Object.keys(s).length>0)try{await R.mutateAsync(s)}catch(i){a=!1}let t=!1,n=!0;if(I.currentPassword||I.newPassword||I.confirmPassword)if(t=!0,I.currentPassword)if(I.newPassword)if(I.newPassword.length<6)K("New password must be at least 6 characters long."),n=!1;else if(I.newPassword!==I.confirmPassword)K("New passwords do not match."),n=!1;else try{await B.mutateAsync({currentPassword:I.currentPassword,newPassword:I.newPassword})}catch(i){n=!1}else K("New password is required."),n=!1;else K("Current password is required to change password."),n=!1;!a||t&&!n||L(!1)},className:"space-y-6",children:[e.jsx(h,{label:"Full Name",id:"name",name:"name",type:"text",value:I.name,onChange:Q,required:!0,disabled:R.isPending}),e.jsx(h,{label:"Email Address",id:"email",name:"email",type:"email",value:I.email,onChange:Q,required:!0,disabled:R.isPending}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Leave blank if you don't want to change your password."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{label:"Current Password",id:"currentPassword",name:"currentPassword",type:"password",value:I.currentPassword,onChange:Q,autoComplete:"current-password",disabled:B.isPending}),e.jsx(h,{label:"New Password",id:"newPassword",name:"newPassword",type:"password",value:I.newPassword,onChange:Q,autoComplete:"new-password",placeholder:"Min. 6 characters",disabled:B.isPending}),e.jsx(h,{label:"Confirm New Password",id:"confirmPassword",name:"confirmPassword",type:"password",value:I.confirmPassword,onChange:Q,autoComplete:"new-password",disabled:B.isPending})]})]}),S&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:S}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(d,{type:"submit",variant:"primary",isLoading:R.isPending||B.isPending,disabled:R.isPending||B.isPending,children:"Save Changes"})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 sm:w-1/4",children:"Full Name"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:w-3/4",children:r?.name})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 sm:w-1/4",children:"Email Address"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:w-3/4",children:r?.email})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 sm:w-1/4",children:"Password"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:w-3/4",children:"******** (Last updated: N/A)"})," "]})]})]}),e.jsxs("section",{className:"card p-6 sm:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"Application Integrations"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Manage your connections to third-party services like Discord."}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 dark:text-white",children:"Discord Integration"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Link your Discord account to enable bot features and notifications."})]}),e.jsx(t,{to:"/settings/integrations",children:e.jsx(d,{variant:"secondary",leftIcon:e.jsx(f,{className:"h-5 w-5"}),children:"Manage Discord"})})]})]}),e.jsxs("section",{className:"card p-6 sm:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Manage how you receive notifications from Labnex."}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 dark:text-white",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Receive important updates and alerts via email."})]}),e.jsx(E,{checked:r?.emailNotifications||!1,onChange:e=>{$.mutate({emailNotifications:e})},srLabel:"Toggle Email Notifications",disabled:$.isPending})]})]}),e.jsx(A,{}),e.jsxs("section",{className:"card p-6 sm:p-8 border-red-500/50 dark:border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 dark:text-red-400 mb-1",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Permanently delete your Labnex account and all associated data. This action cannot be undone."}),e.jsx(d,{variant:"danger",onClick:()=>{O(""),G(""),D(!0)},disabled:W.isPending,children:"Delete My Account"})]}),e.jsxs(F,{isOpen:q,onClose:_,title:"Confirm Account Deletion",footer:e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"danger",onClick:async()=>{T?(G(""),W.mutate(T)):G("Password is required to confirm deletion.")},isLoading:W.isPending,className:"w-full sm:w-auto",children:"Confirm Deletion"}),e.jsx(d,{variant:"secondary",onClick:_,disabled:W.isPending,className:"w-full sm:w-auto",children:"Cancel"})]}),children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"This action is permanent and cannot be undone. All your projects, tasks, test cases, notes, and snippets will be deleted."}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Please type your current password to confirm."}),e.jsx(h,{type:"password",name:"deletePassword",value:T,onChange:e=>{O(e.target.value),z&&G("")},placeholder:"Current Password",className:"w-full "+(z?"border-red-500 focus:ring-red-500 focus:border-red-500":"focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-500 dark:focus:border-blue-500"),disabled:W.isPending,autoFocus:!0}),z&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:z})]})]})},F=({isOpen:a,onClose:t,title:r,children:n,footer:i})=>a?(s.useEffect(()=>{const e=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t]),e.jsx("div",{className:"fixed inset-0 z-[100] overflow-y-auto bg-black/70 backdrop-blur-sm flex items-center justify-center transition-opacity duration-300 p-4","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",onClick:t,children:e.jsxs("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md transform transition-transform duration-300 scale-100 p-6 sm:p-8",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{id:"modal-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:r}),e.jsxs("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-1 -mr-2 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800",children:[e.jsx("span",{className:"sr-only",children:"Close modal"}),e.jsx("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-4",children:n}),i&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-slate-700 flex flex-col-reverse sm:flex-row sm:justify-end gap-3",children:i})]})})):null;export{I as default};
