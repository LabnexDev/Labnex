import{j as e}from"./markdown-core-J3SG-zFE.js";import{r as s}from"./router-W3ruk9z3.js";import{b as t,u as a,c as o}from"./query-DQpHUI-d.js";import{a as r,L as l,o as n,B as i,p as c}from"../assets/index-DzQGG0sq.js";import{b as d}from"./projects-C7_LdZWl.js";import{C as m}from"./Card-DNmxhqo8.js";import{I as u}from"./Input-Di4d9ysK.js";import{c as x}from"./other-heavy-BrS_fVLY.js";import{M as p}from"./Modal-B3wKZjd4.js";import{F as h}from"./PlusCircleIcon-B2u9WL21.js";import{F as j}from"./PencilIcon-CwciGq70.js";import{F as g}from"./TrashIcon-S028_C7U.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";import"./ui-headless-BOwnFwqN.js";import"./XMarkIcon-Bv5SMunc.js";const f=async e=>(await r.post("/notes",e)).data,b=async e=>(await r.delete(`/notes/${e}`)).data,v=async e=>(await r.post("/notes/ai",e)).data,N=({note:s,onEdit:t,onDelete:a})=>e.jsxs("div",{className:"mb-4 break-inside-avoid-column card hover:shadow-glow-blue transition-shadow duration-300 group",children:[e.jsx("div",{className:"p-4 flex-grow",children:e.jsx("p",{className:"text-slate-100 whitespace-pre-wrap flex-grow break-words text-sm leading-relaxed",children:s.content})}),e.jsxs("div",{className:"px-4 py-3 border-t border-slate-700/70 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-400 space-x-2",children:[s.project&&"object"==typeof s.project&&e.jsxs("span",{className:"inline-block bg-slate-700 px-2 py-0.5 rounded text-slate-300 font-medium",children:["Project: ",s.project.name]}),e.jsxs("span",{children:["Last updated: ",new Date(s.updatedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex-shrink-0 space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx(i,{size:"sm",onClick:()=>t(s),title:"Edit Note",children:e.jsx(j,{className:"h-5 w-5 text-slate-400 hover:text-blue-400 transition-colors"})}),e.jsx(i,{color:"danger",size:"sm",onClick:()=>a(s._id),title:"Delete Note",children:e.jsx(g,{className:"h-5 w-5 text-slate-400 hover:text-red-400 transition-colors"})})]})]})]}),w=()=>{const j=t(),[g,w]=s.useState(!1),[y,k]=s.useState(null),[C,I]=s.useState(""),[F,S]=s.useState(void 0),[L,A]=s.useState(void 0),[P,E]=s.useState(!1),[_,q]=s.useState(""),[z,D]=s.useState(void 0),{data:K,isLoading:M,error:O,isFetching:Q}=a({queryKey:["notes",L],queryFn:()=>(async e=>{const s=e?{projectId:e}:{};return(await r.get("/notes",{params:s})).data})(L)}),{data:B,isLoading:Y}=a({queryKey:["projectsListForNotes"],queryFn:()=>d()}),$=o({mutationFn:f,onSuccess:()=>{x.success("Note created successfully!"),j.invalidateQueries({queryKey:["notes",F]}),w(!1),I(""),S(void 0)},onError:e=>{x.error(e.response?.data?.message||"Failed to create note.")}}),G=o({mutationFn:e=>(async(e,s)=>(await r.put(`/notes/${e}`,s)).data)(e.noteId,e.data),onSuccess:()=>{j.invalidateQueries({queryKey:["notes"]}),x.success("Note updated successfully!"),w(!1),k(null)},onError:e=>{x.error(e.response?.data?.message||"Failed to update note.")}}),H=o({mutationFn:b,onSuccess:()=>{j.invalidateQueries({queryKey:["notes"]}),x.success("Note deleted successfully!")},onError:e=>{x.error(e.response?.data?.message||"Failed to delete note.")}}),R=o({mutationFn:v,onSuccess:()=>{j.invalidateQueries({queryKey:["notes"]}),x.success("AI-generated note created successfully!"),E(!1),q(""),D(void 0)},onError:e=>{x.error(e.response?.data?.message||"Failed to create note with AI.")}}),T=e=>{k(e),I(e.content),e.project&&"object"==typeof e.project?S(e.project._id):"string"==typeof e.project?S(e.project):S(void 0),w(!0)},W=e=>{window.confirm("Are you sure you want to delete this note?")&&H.mutate(e)};return M&&!K?e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-[60vh]",children:[e.jsx(l,{size:"lg"}),e.jsx("p",{className:"mt-4 text-lg",children:"Loading your notes..."})]}):e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("header",{className:"mb-6 md:mb-8 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-teal-300 to-green-300 flex items-center self-start md:self-center",children:[e.jsx(n,{className:"h-8 w-8 md:h-10 md:w-10 mr-3 text-blue-400"})," My Notes"]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 w-full md:w-auto",children:[e.jsxs(u,{as:"select",value:L||"",onChange:e=>A(e.target.value||void 0),className:"w-full md:w-56 bg-slate-700/50 border-slate-600 text-slate-200 placeholder-slate-400 focus:ring-blue-500 focus:border-blue-500 text-sm rounded-md shadow-sm",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"All Projects"}),Y&&e.jsx("option",{value:"",disabled:!0,className:"bg-slate-800",children:"Loading projects..."}),B&&B.map(s=>e.jsx("option",{value:s._id,className:"bg-slate-800",children:s.name},s._id))]}),e.jsx(i,{variant:"primary",onClick:()=>{k(null),I(""),S(L),w(!0)},leftIcon:e.jsx(h,{className:"h-5 w-5"}),className:"flex-shrink-0 shadow-md hover:shadow-blue-500/40",children:"Add Note"}),e.jsx(i,{variant:"secondary",onClick:()=>{q(""),D(L),E(!0)},leftIcon:e.jsx(c,{className:"h-5 w-5"}),className:"flex-shrink-0 shadow-md",children:"AI Assistant"})]})]}),Q&&!M&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsxs("div",{className:"flex items-center bg-slate-700/80 backdrop-blur-md text-slate-200 px-3 py-2 rounded-lg shadow-lg",children:[e.jsx(l,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm",children:"Refreshing notes..."})]})}),O&&e.jsx(m,{className:"bg-red-900/30 border-red-700 text-red-300 p-4 rounded-lg shadow-lg",children:e.jsxs(m.Content,{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Error loading notes: ",O.message||"An unknown error occurred."]})}),K&&K.length>0?e.jsx("div",{className:"columns-1 sm:columns-2 md:columns-3 lg:columns-3 xl:columns-4 gap-4 md:gap-6",children:K.map(s=>e.jsx(N,{note:s,onEdit:T,onDelete:W},s._id))}):!M&&!O&&e.jsxs("div",{className:"card text-center py-16 min-h-[60vh] flex flex-col items-center justify-center gap-4",children:[e.jsx(n,{className:"h-20 w-20 text-slate-500 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-slate-300",children:"No Notes Yet"}),e.jsx("p",{className:"text-slate-400 mt-3 max-w-md mx-auto",children:L?"No notes match the current filter.":'Click "Add Note" or use the "AI Assistant" to create your first note!'}),e.jsx(i,{variant:"primary",className:"mt-8 shadow-lg hover:shadow-blue-500/50",onClick:()=>{k(null),I(""),S(L),w(!0)},leftIcon:e.jsx(h,{className:"h-5 w-5"}),children:"Create Your First Note"})]}),g&&e.jsx(p,{isOpen:g,onClose:()=>{w(!1),k(null),I(""),S(void 0)},title:y?"Edit Note":"Create New Note",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("textarea",{value:C,onChange:e=>I(e.target.value),placeholder:"Enter your note content here...",rows:8,className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-md text-slate-100 placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"projectSelect",className:"block text-sm font-medium text-slate-300 mb-1",children:"Link to Project (Optional)"}),e.jsxs("select",{id:"projectSelect",value:F||"",onChange:e=>S(e.target.value||void 0),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-md text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"No Project"}),Y&&e.jsx("option",{value:"",disabled:!0,className:"bg-slate-800",children:"Loading projects..."}),B&&B.map(s=>e.jsx("option",{value:s._id,className:"bg-slate-800",children:s.name},s._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(i,{variant:"secondary",onClick:()=>{w(!1),k(null),I(""),S(void 0)},children:"Cancel"}),e.jsx(i,{variant:"primary",onClick:y?()=>{y&&(""!==C.trim()?G.mutate({noteId:y._id,data:{content:C,projectId:""===F?null:F}}):x.error("Note content cannot be empty."))}:()=>{if(""===C.trim())return void x.error("Note content cannot be empty.");const e=C.substring(0,30)+(C.length>30?"...":"");$.mutate({title:e,content:C,projectId:F})},isLoading:$.isPending||G.isPending,className:"shadow-md hover:shadow-blue-500/40",children:y?"Save Changes":"Create Note"})]})]})}),P&&e.jsx(p,{isOpen:P,onClose:()=>{E(!1),q(""),D(void 0)},title:"Create Note with AI Assistant",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("textarea",{value:_,onChange:e=>q(e.target.value),placeholder:"Describe the note you want the AI to create (e.g., 'Brainstorm ideas for a new feature', 'Summarize the key points of the last meeting')...",rows:5,className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-md text-slate-100 placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aiProjectSelect",className:"block text-sm font-medium text-slate-300 mb-1",children:"Link to Project (Optional)"}),e.jsxs("select",{id:"aiProjectSelect",value:z||"",onChange:e=>D(e.target.value||void 0),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-md text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"No Project"}),Y&&e.jsx("option",{value:"",disabled:!0,className:"bg-slate-800",children:"Loading projects..."}),B&&B.map(s=>e.jsx("option",{value:s._id,className:"bg-slate-800",children:s.name},s._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(i,{variant:"secondary",onClick:()=>E(!1),children:"Cancel"}),e.jsx(i,{variant:"primary",onClick:()=>{""!==_.trim()?R.mutate({prompt:_,projectId:z}):x.error("AI prompt cannot be empty.")},isLoading:R.isPending,leftIcon:e.jsx(c,{className:"h-5 w-5"}),className:"shadow-md hover:shadow-blue-500/40",children:"Generate Note"})]})]})})]})};export{w as NotesPage};
