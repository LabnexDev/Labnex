import{j as e}from"./markdown-core-J3SG-zFE.js";import{b as s,u as t,c as a}from"./query-DQpHUI-d.js";import{d as r,u as i,g as n}from"./testCases-t9GenQsh.js";import{b as d,L as l,B as o,F as c,c as m,d as x,e as p}from"../assets/index-DzQGG0sq.js";import{E as u}from"./ErrorMessage-Bz_uBxpF.js";import{c as j}from"./other-heavy-BrS_fVLY.js";import{c as g,u as h,r as f}from"./router-W3ruk9z3.js";import{F as y}from"./UserCircleIcon-CEdGODWc.js";import{F as b}from"./CalendarDaysIcon-DBg9AJpN.js";import{F as N}from"./ClockIcon-Cv-9l8Jz.js";import{F as k}from"./ArrowUturnLeftIcon-mLw3q7z9.js";import{F as w}from"./PencilSquareIcon-2N_h3NB9.js";import{F as v}from"./TrashIcon-S028_C7U.js";import{F as I}from"./ClipboardDocumentListIcon-BnEqRuOb.js";import{F as D}from"./TagIcon-C6Si0vbn.js";import{F as C}from"./ExclamationTriangleIcon-CjBC6hcD.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";const E={PASSED:"bg-green-100 text-green-700 dark:bg-green-600/30 dark:text-green-300",FAILED:"bg-red-100 text-red-700 dark:bg-red-600/30 dark:text-red-300",PENDING:"bg-yellow-100 text-yellow-700 dark:bg-yellow-500/30 dark:text-yellow-300"},F={HIGH:"bg-red-100 text-red-700 dark:bg-red-600/30 dark:text-red-300 font-medium",MEDIUM:"bg-yellow-100 text-yellow-700 dark:bg-yellow-500/30 dark:text-yellow-300 font-medium",LOW:"bg-blue-100 text-blue-700 dark:bg-blue-600/30 dark:text-blue-300 font-medium"};function P(){const{id:P,testCaseId:S}=g(),L=h(),A=s(),{setPageContext:T}=d();f.useEffect(()=>{P&&"undefined"!==P&&S&&"undefined"!==S||(j.error("Invalid project or test case ID. Redirecting..."),L(P&&"undefined"!==P?`/projects/${P}/test-cases`:"/dashboard"))},[P,S,L]);const{data:q,isLoading:$,error:U}=t({queryKey:["testCase",P,S],queryFn:()=>P&&"undefined"!==P&&S&&"undefined"!==S?n(P,S):Promise.reject(new Error("Invalid project or test case ID")),enabled:!!P&&"undefined"!==P&&!!S&&"undefined"!==S});f.useEffect(()=>{q&&P&&S&&T({view:"testCaseDetails",projectId:P,projectName:q.project?.name??void 0,selectedTestCaseId:q._id})},[q,P,S,T]);const G=a({mutationFn:e=>P&&"undefined"!==P&&S&&"undefined"!==S?i(P,S,e):(j.error("Cannot update status: Invalid project or test case ID."),Promise.reject(new Error("Invalid project or test case ID"))),onSuccess:e=>{A.setQueryData(["testCase",P,S],e),A.invalidateQueries({queryKey:["testCases",P]}),A.invalidateQueries({queryKey:["project",P]}),j.success(`Test case status updated to ${e.status}.`)},onError:e=>{j.error(e.response?.data?.message||"Failed to update status.")}}),z=a({mutationFn:()=>P&&"undefined"!==P&&S&&"undefined"!==S?r(P,S):(j.error("Cannot delete: Invalid project or test case ID."),Promise.reject(new Error("Invalid project or test case ID"))),onSuccess:()=>{j.success("Test case deleted successfully."),A.invalidateQueries({queryKey:["testCases",P]}),A.invalidateQueries({queryKey:["project",P]}),L(P&&"undefined"!==P?`/projects/${P}/test-cases`:"/dashboard")},onError:e=>{j.error(e.response?.data?.message||"Failed to delete test case.")}});if($)return e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:e.jsx(l,{size:"lg"})});if(U||!q)return e.jsx(u,{title:"Error Loading Test Case",message:U?.message||"Could not find the requested test case. It might have been deleted or the link is incorrect."});const B=[{label:"Created By",value:q.createdBy.name,icon:y},{label:"Created Date",value:new Date(q.createdAt).toLocaleDateString("en-US",{dateStyle:"medium"}),icon:b},{label:"Last Updated",value:new Date(q.updatedAt).toLocaleDateString("en-US",{dateStyle:"medium"}),icon:N},...q.assignedTo?[{label:"Assigned To",value:q.assignedTo.name,icon:y}]:[]];return e.jsxs("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx(o,{variant:"tertiary",onClick:()=>{L(P&&"undefined"!==P?`/projects/${P}/test-cases`:"/dashboard")},leftIcon:e.jsx(k,{className:"h-5 w-5"}),className:"text-sm mb-2 pl-0 p-0 hover:bg-transparent dark:hover:bg-transparent focus:ring-0 text-blue-600 dark:text-blue-400 hover:underline",children:"Back to Test Cases"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white break-all",children:q.title})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsx(o,{variant:"secondary",onClick:()=>{P&&"undefined"!==P&&S&&"undefined"!==S?L(`/projects/${P}/test-cases/${S}/edit`):j.error("Cannot edit: Invalid project or test case context.")},leftIcon:e.jsx(w,{className:"h-5 w-5"}),children:"Edit"}),e.jsx(o,{variant:"danger",onClick:()=>{window.confirm("Are you sure you want to delete this test case? This action cannot be undone.")&&z.mutate()},leftIcon:e.jsx(v,{className:"h-5 w-5"}),isLoading:z.isPending,children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[q.description&&e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(c,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Description"]}),e.jsx("div",{className:"prose prose-sm sm:prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:q.description})]}),e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(m,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Test Steps"]}),q.steps&&q.steps.length>0?e.jsx("ol",{className:"space-y-3 pl-1",children:q.steps.map((s,t)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-3 mt-0.5 flex-shrink-0 h-6 w-6 rounded-full bg-blue-500 dark:bg-blue-400 text-white dark:text-gray-900 text-sm flex items-center justify-center font-semibold",children:t+1}),e.jsx("div",{className:"prose prose-sm sm:prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-wrap pt-0.5",children:s})]},t))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No steps defined for this test case."})]}),e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(I,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Expected Result"]}),e.jsx("div",{className:"prose prose-sm sm:prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:q.expectedResult||"No expected result defined."})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(D,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Status & Priority"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Current Status:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${E[q.status]||"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200"}\n                  `,children:q.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Priority:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${F[q.priority]||"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200"}\n                    `,children:q.priority})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Update Status:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(o,{variant:"PASSED"===q.status?"primary":"secondary",size:"sm",onClick:()=>G.mutate("PASSED"),isLoading:G.isPending&&"PASSED"===G.variables,leftIcon:e.jsx(x,{className:"h-4 w-4"}),children:"Pass"}),e.jsx(o,{variant:"FAILED"===q.status?"danger":"secondary",size:"sm",onClick:()=>G.mutate("FAILED"),isLoading:G.isPending&&"FAILED"===G.variables,leftIcon:e.jsx(p,{className:"h-4 w-4"}),children:"Fail"}),e.jsx(o,{variant:"PENDING"===q.status?"tertiary":"secondary",size:"sm",onClick:()=>G.mutate("PENDING"),isLoading:G.isPending&&"PENDING"===G.variables,leftIcon:e.jsx(C,{className:"h-4 w-4"}),children:"Pending"})]})]})]})]}),e.jsxs("section",{className:"card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(c,{className:"h-6 w-6 mr-2 text-blue-500 dark:text-blue-400"})," Details"]}),e.jsx("dl",{className:"space-y-3 text-sm",children:B.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("dt",{className:"flex items-center font-medium text-gray-600 dark:text-gray-400",children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2 text-gray-500 dark:text-gray-400/80 flex-shrink-0"}),s.label,":"]}),e.jsx("dd",{className:"text-gray-800 dark:text-gray-200 text-right",children:s.value})]},s.label))})]})]})]})]})}export{P as TestCaseDetails};
