import{j as e}from"./markdown-core-J3SG-zFE.js";import{c as t,u as s,r}from"./router-W3ruk9z3.js";import{b as a,c as i}from"./query-DQpHUI-d.js";import{c as o}from"./testCases-t9GenQsh.js";import{B as n}from"../assets/index-DzQGG0sq.js";import{I as l}from"./Input-Di4d9ysK.js";import{c as d}from"./other-heavy-BrS_fVLY.js";import{F as c}from"./ArrowUturnLeftIcon-mLw3q7z9.js";import{F as m}from"./ArrowDownTrayIcon-CalA_AYt.js";import{F as p}from"./TrashIcon-S028_C7U.js";import{F as u}from"./PlusIcon-DmexcfTS.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";function x(){const{id:x}=t(),f=s(),j=a(),[h,y]=r.useState(""),[g,b]=r.useState(""),[v,N]=r.useState([""]),[w,C]=r.useState(""),[k,I]=r.useState(""),[S,T]=r.useState("MEDIUM"),[D,E]=r.useState(""),[,$]=r.useState(!1);r.useEffect(()=>{x&&"undefined"!==x||(d.error("Project ID is invalid or missing. Redirecting to dashboard."),f("/dashboard"))},[x,f]);const{mutate:q,isPending:R}=i({mutationFn:e=>x&&"undefined"!==x?o(x,e):(d.error("Cannot create test case: Project ID is invalid or missing."),Promise.reject(new Error("Project ID is invalid or missing"))),onSuccess:e=>{const t=e.taskReferenceId?`Test case "${e.title}" (${e.taskReferenceId}) created successfully!`:`Test case "${e.title}" created successfully!`;d.success(t),j.invalidateQueries({queryKey:["testCases",x]}),j.invalidateQueries({queryKey:["project",x]}),f(x&&"undefined"!==x?`/projects/${x}/test-cases`:"/dashboard")},onError:e=>{const t=e.response?.data?.message||"Failed to create test case. Please try again.";t.includes("E11000")&&t.toLowerCase().includes("title")?(d.error("Test case title already exists in this project. Please use a different name."),E("Test case title already exists in this project.")):(d.error(t),E(""))}});return e.jsxs("div",{className:"container mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Create New Test Case"}),e.jsx(n,{variant:"secondary",onClick:()=>{f(x&&"undefined"!==x?`/projects/${x}/test-cases`:"/dashboard")},leftIcon:e.jsx(c,{className:"h-5 w-5"}),children:"Back to Test Cases"})]}),e.jsx("div",{className:"card p-6 sm:p-8",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),E(""),h.trim()?v.some(e=>!e.trim())?E("All step descriptions are required and cannot be empty."):0!==v.length?k.trim()?q({title:h,description:g,steps:v.filter(e=>e.trim()),expectedResult:k,priority:S}):E("Expected result is required"):E("At least one test step is required."):E("Title is required")},className:"space-y-6",children:[D&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-md relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Validation Error: "}),e.jsx("span",{className:"block sm:inline",children:D})]}),e.jsx(l,{id:"title",label:"Title",type:"text",value:h,onChange:e=>y(e.target.value),placeholder:"Enter test case title",required:!0}),e.jsx(l,{id:"description",label:"Description (Optional)",as:"textarea",rows:4,value:g,onChange:e=>b(e.target.value),placeholder:"Detailed description of the test case"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Paste Raw Steps (optional)"}),e.jsx("textarea",{value:w,onChange:e=>C(e.target.value),rows:4,className:"w-full p-3 border rounded-md mb-3 dark:bg-gray-800 dark:border-gray-600",placeholder:"1 Visit …\\n2 Wait …"}),e.jsx(n,{type:"button",variant:"secondary",size:"sm",onClick:()=>{const e=w.split("\n").map(e=>e.trim()).filter(e=>e);e.length?(N(e),C(""),d.success(`Converted ${e.length} steps from pasted text.`)):d.error("Could not parse any steps from the provided text.")},leftIcon:e.jsx(m,{className:"h-4 w-4"}),className:"mb-6",children:"Convert to Steps"}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Or upload steps (.txt) / bulk JSON (.json)"}),e.jsx("input",{type:"file",accept:".txt,.json",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;const s=await t.text();if(t.name.endsWith(".txt"))C(s),d.success("Text file loaded – click Convert to Steps");else if(t.name.endsWith(".json"))try{const e=JSON.parse(s);if(!Array.isArray(e))throw new Error("JSON must be an array");if(!x||"undefined"===x)return;$(!0);let t=0;for(const s of e){if("object"!=typeof s)continue;await o(x,{title:s.title||`Imported ${Date.now()}`,description:s.description||"",expectedResult:s.expectedResult||"",steps:Array.isArray(s.steps)?s.steps:[],priority:s.priority||"MEDIUM"})&&(t+=1)}d.success(`Imported ${t} test cases from JSON`),f(`/projects/${x}/test-cases`)}catch(r){d.error(`Failed to import JSON: ${r.message||r}`)}finally{$(!1)}else d.error("Unsupported file type");e.target.value=""}})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Test Steps"}),e.jsxs("div",{className:"space-y-3",children:[v.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-700/50 rounded-md",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:["#",s+1]}),e.jsx(l,{type:"text",value:t,onChange:e=>((e,t)=>{const s=[...v];s[e]=t,N(s)})(s,e.target.value),className:"flex-1 !mt-0",placeholder:`Describe step ${s+1}`,required:!0,hideLabel:!0}),v.length>1&&e.jsx(n,{type:"button",variant:"danger",size:"sm",onClick:()=>(e=>{N(v.filter((t,s)=>s!==e))})(s),leftIcon:e.jsx(p,{className:"h-4 w-4"}),"aria-label":"Remove step",children:"Remove"})]},s)),e.jsx(n,{type:"button",variant:"secondary",onClick:()=>{N([...v,""])},leftIcon:e.jsx(u,{className:"h-5 w-5"}),className:"w-full sm:w-auto",children:"Add Step"})]})]}),e.jsx(l,{id:"expectedResult",label:"Expected Result",as:"textarea",rows:4,value:k,onChange:e=>I(e.target.value),placeholder:"What is the expected outcome after performing the steps?",required:!0}),e.jsxs(l,{id:"priority",label:"Priority",as:"select",value:S,onChange:e=>T(e.target.value),required:!0,children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(n,{type:"button",variant:"tertiary",onClick:()=>{f(x&&"undefined"!==x?`/projects/${x}/test-cases`:"/dashboard")},disabled:R||!x||"undefined"===x,children:"Cancel"}),e.jsx(n,{type:"submit",variant:"primary",isLoading:R||!x||"undefined"===x,disabled:R||!x||"undefined"===x,children:R?"Creating Test Case...":"Create Test Case"})]})]})})]})}export{x as CreateTestCase};
