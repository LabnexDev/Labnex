import{j as e}from"./markdown-core-J3SG-zFE.js";import{c as t,u as s,r}from"./router-W3ruk9z3.js";import{b as a,u as i,c as n}from"./query-DQpHUI-d.js";import{a as d,g as l}from"./testCases-t9GenQsh.js";import{L as o}from"../assets/index-DzQGG0sq.js";import{c}from"./other-heavy-BrS_fVLY.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";function u(){const{id:u,testCaseId:m}=t(),p=s(),x=a(),[j,f]=r.useState(""),[h,b]=r.useState(""),[v,y]=r.useState([""]),[g,N]=r.useState(""),[C,E]=r.useState("MEDIUM"),[w,S]=r.useState("");r.useEffect(()=>{u&&"undefined"!==u&&m&&"undefined"!==m||(c.error("Invalid project or test case ID. Redirecting..."),p(u&&"undefined"!==u?`/projects/${u}/test-cases`:"/dashboard"))},[u,m,p]);const{data:k,isLoading:I}=i({queryKey:["testCase",u,m],queryFn:()=>u&&"undefined"!==u&&m&&"undefined"!==m?l(u,m):Promise.reject(new Error("Invalid project or test case ID")),enabled:!!u&&"undefined"!==u&&!!m&&"undefined"!==m}),{mutate:q,isPending:D}=n({mutationFn:e=>u&&"undefined"!==u&&m&&"undefined"!==m?d(u,m,e):(c.error("Cannot update test case: Invalid ID(s)."),Promise.reject(new Error("Invalid project or test case ID"))),onSuccess:()=>{x.invalidateQueries({queryKey:["testCase",u,m]}),x.invalidateQueries({queryKey:["testCases"]}),c.success("Test Case updated successfully!"),p(u&&"undefined"!==u&&m&&"undefined"!==m?`/projects/${u}/test-cases/${m}`:u&&"undefined"!==u?`/projects/${u}/test-cases`:"/dashboard")},onError:()=>{S("Failed to update test case")}});r.useEffect(()=>{k&&(f(k.title),b(k.description),y(k.steps),N(k.expectedResult),E(k.priority))},[k]);return I?e.jsx(o,{}):u&&"undefined"!==u&&m&&"undefined"!==m?e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Edit Test Case"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),S(""),j.trim()?v.some(e=>!e.trim())?S("All steps must be filled"):g.trim()?q({title:j,description:h,steps:v.filter(e=>e.trim()),expectedResult:g,priority:C}):S("Expected result is required"):S("Title is required")},className:"space-y-6",children:[w&&e.jsx("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:w})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-300 mb-2",children:"Title"}),e.jsx("input",{id:"title",type:"text",value:j,onChange:e=>f(e.target.value),className:"input w-full",placeholder:"Enter test case title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:h,onChange:e=>b(e.target.value),className:"input w-full h-32 resize-none",placeholder:"Enter test case description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Test Steps"}),e.jsxs("div",{className:"space-y-4",children:[v.map((t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:e=>((e,t)=>{const s=[...v];s[e]=t,y(s)})(s,e.target.value),className:"input flex-1",placeholder:`Step ${s+1}`,required:!0}),v.length>1&&e.jsx("button",{type:"button",onClick:()=>(e=>{y(v.filter((t,s)=>s!==e))})(s),className:"btn btn-danger",children:"Remove"})]},s)),e.jsx("button",{type:"button",onClick:()=>{y([...v,""])},className:"btn btn-secondary w-full",children:"Add Step"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expectedResult",className:"block text-sm font-medium text-gray-300 mb-2",children:"Expected Result"}),e.jsx("textarea",{id:"expectedResult",value:g,onChange:e=>N(e.target.value),className:"input w-full h-32 resize-none",placeholder:"Enter expected result",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-300 mb-2",children:"Priority"}),e.jsxs("select",{id:"priority",value:C,onChange:e=>E(e.target.value),className:"input w-full",children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>{p(u&&"undefined"!==u&&m&&"undefined"!==m?`/projects/${u}/test-cases/${m}`:u&&"undefined"!==u?`/projects/${u}/test-cases`:"/dashboard")},className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:D||I||!u||"undefined"===u||!m||"undefined"===m,children:D?"Saving...":"Save Changes"})]})]})]}):null}export{u as EditTestCase};
