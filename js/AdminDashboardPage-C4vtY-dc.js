import{j as e}from"./markdown-core-J3SG-zFE.js";import{r as t}from"./router-W3ruk9z3.js";import{b as a,u as s,c as r}from"./query-DQpHUI-d.js";import{a as i,B as n,L as c}from"../assets/index-DzQGG0sq.js";import{V as l}from"./other-heavy-BrS_fVLY.js";import"./react-core-eVk5PToZ.js";import"./markdown-syntax-D_e3LpQv.js";import"./api-axios-ztdpVPaQ.js";import"./animations-framer-BqiiQv6P.js";import"./forms-hook-uaZDsLJv.js";import"./forms-resolvers-o9eYnsGV.js";import"./forms-zod-BHhVsmmU.js";const d=async()=>{const e=await i.get("/admin/waitlist");if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to fetch waitlist entries")},x=async e=>{const t=await i.post("/admin/waitlist/approve",{email:e});if(t.data.success)return t.data.data;throw new Error(t.data.message||"Failed to approve waitlist user")},o=async()=>{const e=await i.get("/admin/user-engagement-stats");if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to fetch user engagement stats")},m=async()=>{const e=await i.post("/api-keys",{label:"Runner Key"});if("token"in e.data)return e.data.token;throw new Error(e.data.message||"Failed to generate runner API key")},p=["waitlistEntries"],g=["userEngagementStats"],h=()=>{const i=a(),[h,y]=t.useState("waitlist"),[u,j]=t.useState(null),{data:w,isLoading:f,error:N,refetch:b}=s({queryKey:p,queryFn:d}),{data:v,isLoading:k,error:A,refetch:E}=s({queryKey:g,queryFn:o,enabled:"engagement"===h}),C=r({mutationFn:x,onSuccess:(e,t)=>{l.success(`User ${t} approved successfully! Account created.`),e.generatedPasswordInfo&&l.success(e.generatedPasswordInfo,{duration:8e3,id:`approve-info-${t}`}),i.invalidateQueries({queryKey:p})},onError:(e,t)=>{l.error(`Failed to approve ${t}: ${e.message}`)}}),F=r({mutationFn:m,onSuccess:e=>{j(e),navigator.clipboard.writeText(e).catch(()=>{}),l.success("Runner API key generated and copied to clipboard!",{duration:6e3,id:"runner-key"})},onError:e=>{l.error(`Failed to generate key: ${e.message}`)}});return e.jsxs("div",{className:"p-6 bg-gray-900 text-gray-100 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-purple-400",children:"Admin Dashboard"}),e.jsx("div",{className:"mb-6 border-b border-gray-700",children:e.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>y("waitlist"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \n                        "+("waitlist"===h?"border-purple-500 text-purple-400":"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500"),children:"Waitlist Management"}),e.jsx("button",{onClick:()=>y("engagement"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \n                        "+("engagement"===h?"border-purple-500 text-purple-400":"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500"),children:"User Engagement"})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-4",children:[e.jsx(n,{variant:"primary",onClick:()=>F.mutate(),isLoading:F.isPending,children:"Generate Runner API Key"}),u&&e.jsx("span",{className:"text-sm text-green-400 break-all",children:u})]}),"waitlist"===h&&(f?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(c,{size:"lg"})}):N?(l.error(`Failed to fetch waitlist: ${N.message}`,{id:"fetch-waitlist-error"}),e.jsxs("div",{className:"p-4 text-red-400",children:["Error fetching waitlist: ",N.message,e.jsx(n,{onClick:()=>b&&b(),className:"ml-4",children:"Retry"})]})):w&&0!==w.length?e.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg bg-gray-800",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Joined At"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-750 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:new Date(t.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx(n,{variant:"primary",size:"sm",onClick:()=>{return e=t.email,void C.mutate(e);var e},isLoading:C.isPending&&C.variables===t.email,className:"bg-green-500 hover:bg-green-600 text-white",disabled:C.isPending&&C.variables===t.email,children:"Approve & Create Account"})})]},t._id))})]})}):e.jsx("p",{className:"text-gray-400 text-center py-10",children:"The waitlist is currently empty."})),"engagement"===h&&(k?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(c,{size:"lg"})}):A?(l.error(`Failed to fetch engagement stats: ${A.message}`,{id:"fetch-engagement-error"}),e.jsxs("div",{className:"p-4 text-red-400",children:["Error fetching engagement stats: ",A.message,e.jsx(n,{onClick:()=>E&&E(),className:"ml-4",children:"Retry"})]})):v&&0!==v.length?e.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg bg-gray-800",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Registered"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Last Login"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Projects"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Tasks"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Test Cases"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Snippets"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-750 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-100",children:t.name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-100",children:t.email}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-300",children:t.systemRole||"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-400",children:t.lastLoginAt?new Date(t.lastLoginAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-200",children:t.projectsOwned}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-200",children:t.tasksCreated}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-200",children:t.testCasesCreated}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-200",children:t.notesCreated}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-200",children:t.snippetsCreated})]},t.id))})]})}):e.jsx("p",{className:"text-gray-400 text-center py-10",children:"No user engagement data available."}))]})};export{h as default};
